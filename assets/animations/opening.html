<meta name="viewport" content="width=device-width, user-scalable=no" />
<meta name="apple-mobile-web-app-capable" content="yes" />
<script src='http://cdn.rawgit.com/phi-jp/phina.js/v0.2.0/build/phina.js'></script>
<script>
phina.globalize();

// 定数
const ASSETS = {
  image: {
    // dragon: 'https://drive.google.com/uc?id=1EJ6i2fMe5JGL-k_RyaL2eQXLVehyKbPw'
    dragon: 'https://drive.google.com/uc?id=18Nc6JMrhWp9dU8mtp9Lc3zkw4MuxhIbW'
  },
};

// 画面の解像度
const SCREEN_WIDTH  = window.parent.screen.width * 2;
const SCREEN_HEIGHT = window.parent.screen.height * 2;
// const SCREEN_WIDTH  = 1080;
// const SCREEN_HEIGHT = 1920;
// アプリ(ブラウザ)の表示領域サイズ 1.78 is magic number
const WINDOW_WIDTH = window.innerWidth * 1.78;
const WINDOW_HEIGHT = window.innerHeight * 1.78;
// const SPEED         = 10;

phina.define("MainScene", {
  superClass: 'CanvasScene',

  init: function(options) {
    this.superInit(options);

    // 縦の4等分
    for (let i = 0; i < 5; i++) {
      var shape = Shape({
        width: WINDOW_WIDTH * 1,
        height: 1,
        backgroundColor: 'red'
      }).setPosition(
          this.gridX.center(),
          WINDOW_HEIGHT / 5 * i
        )
        .addChildTo(this);
    }

    // 横の4等分
    for (let i = 0; i < 5; i++) {
      var shape = Shape({
        width: 1,
        height: WINDOW_HEIGHT,
        backgroundColor: 'red'
      }).setPosition(
          WINDOW_WIDTH / 4 * i,
          this.gridY.center()
        )
        .addChildTo(this);
    }

    this.labelArea = LabelArea({
      text: "window width: " + SCREEN_WIDTH + "\nwindow height: " + SCREEN_HEIGHT + "\ninner width: " + window.innerWidth + "\ninner height: " + window.innerHeight,
      width: 600,
      height: 240,
    }).setPosition(300, 300).addChildTo(this);

    this.dragon = Sprite('dragon', 128, 256).addChildTo(this);
    this.dragon.setPosition(600, 800);
    this.dragon.setRotation(0);
    // this.dragon.frameIndex = 0;

    this.dragon.tweener
      .to({
        x: 400,
        y: 500,
        rotation: -30
      }, 3000, "easeOutQuad");
      // .wait(600)

    // for (var i = 0; i < 3; i++) {
      this.dragon.tweener
        .by({
          x: -2,
          y: -10,
          rotation: -10,
        }, 1000, "easeOutQuad")
        // .wait(800)
        .by({
          x: +2,
          y: +10,
          rotation: +10,
        }, 1000, "easeOutQuad").setLoop(true);
    // }
  },

  update: function() {
  }

  // // 更新
  // update: function(app) {
  //   var p = app.pointer;

  //   if (p.getPointing()) {
  //     var diff = this.player.x - p.x;
  //     if (Math.abs(diff) > SPEED) {
  //       // 右に移動
  //       if (diff < 0) {
  //         this.player.x += SPEED;
  //         this.player.scaleX = -1;
  //       }
  //       // 左に移動
  //       else {
  //         this.player.x -= SPEED;
  //         this.player.scaleX = 1;
  //       }

  //       // フレームアニメーション
  //       if (app.frame % 4 === 0) {
  //         this.player.frameIndex = (this.player.frameIndex === 12) ? 13:12;
  //       }
  //     }
  //   }
  //   else {
  //     // 待機
  //     this.player.frameIndex = 0;
  //   }
  // }
});

/*
 * メイン処理
 */
phina.main(function() {
  // アプリケーションを生成
  var app = GameApp({
    startLabel: 'main',   // MainScene から開始
  //   width: SCREEN_WIDTH,  // 画面幅
  //   height: SCREEN_HEIGHT,// 画面高さ
    assets: ASSETS,       // アセット読み込み
  });

  app.enableStats();

  // 実行
  app.run();
});
</script>
